--TABELA CONVÊNIOS
CREATE TABLE CONVENIO(
    CNPJ VARCHAR(16) PRIMARY KEY,
    NOME VARCHAR(45),
    DESCONTO VARCHAR(15)
);

--TABELA PACIENTES
CREATE TABLE PACIENTE(
    CPF VARCHAR(11) PRIMARY KEY,
    NASCIMENTO DATE,
    IDADE NUMBER,
    END_RUA VARCHAR (15), 
    END_CIDADE VARCHAR(25),
    END_NUM VARCHAR(10), 
    END_BAIRRO VARCHAR(25),
    CONTATO1 VARCHAR(60),
    CONTATO2 VARCHAR(60),
    CONVENIO VARCHAR(16),
    CONSTRAINT FK_PACIENTE_CONV FOREIGN KEY (CONVENIO) REFERENCES CONVENIO (CNPJ) ON DELETE CASCADE
);

--TABELA DENTISTAS
CREATE TABLE DENTISTA(
    CPF VARCHAR(11) PRIMARY KEY,
    NASCIMENTO DATE,
    IDADE NUMBER,
    ESPECIALIZACAO1 VARCHAR(40),
	ESPECIALIZACAO2 VARCHAR(40),
	END_RUA VARCHAR (15), 
    END_CIDADE VARCHAR(25),
    END_NUM VARCHAR(10), 
    END_BAIRRO VARCHAR(25),
    CONTATO1 VARCHAR(60),
    CONTATO2 VARCHAR(60)
);

--TABELA FUNCIONÁRIOS
CREATE TABLE FUNCIONARIO(
    CPF VARCHAR(11) PRIMARY KEY,
    NASCIMENTO DATE,
    IDADE NUMBER,
    END_RUA VARCHAR (15), 
    END_CIDADE VARCHAR(25),
    END_NUM VARCHAR(10), 
    END_BAIRRO VARCHAR(25),
    CONTATO1 VARCHAR(60),
    CONTATO2 VARCHAR(60)
);

--TABELA AUTORELAÇÃO "CHEFIA" (FUNCIONÁRIO X FUNCIONÁRIO)
CREATE TABLE CHEFIA(
    CHEFE VARCHAR(11),
    SUBORDINADO VARCHAR(11),
    CONSTRAINT PK_CHEFIA PRIMARY KEY (CHEFE, SUBORDINADO),
    CONSTRAINT FK_CHEFE_SUB FOREIGN KEY (CHEFE) REFERENCES FUNCIONARIO (CPF) ON DELETE CASCADE,
    CONSTRAINT FK_SUB_CHEFE FOREIGN KEY (SUBORDINADO) REFERENCES FUNCIONARIO (CPF) ON DELETE CASCADE
);

--TABELA PIS
CREATE TABLE PIS(
    NUM VARCHAR(11) PRIMARY KEY,
    CPF VARCHAR(11) UNIQUE NOT NULL,
    CONSTRAINT FK_PIS_FUNCIO FOREIGN KEY (CPF) REFERENCES FUNCIONARIO (CPF) ON DELETE CASCADE
);

--TABELA BENEFICIOS
CREATE TABLE BENEFICIOS(
    BENEFICIOS VARCHAR(100),
    NUM VARCHAR(11),
    CONSTRAINT PK_BENEFICIOS PRIMARY KEY (BENEFICIOS, NUM),
    CONSTRAINT FK_BENEF_PIS FOREIGN KEY (NUM) REFERENCES PIS(NUM) ON DELETE CASCADE
);

--TABELA CONSULTÓRIOS
CREATE TABLE CONSULTORIO(
    CEP VARCHAR (12), 
    ENDERECO VARCHAR (50), 
    CIDADE VARCHAR (25),
    NOME VARCHAR (45),
    CONSTRAINT PK_CONSULTORIO PRIMARY KEY (CEP, ENDERECO)
);

--TABELA SERVIÇOS
CREATE TABLE SERVICO (
    CEP VARCHAR (12), 
    ENDERECO VARCHAR (50), 
    CPF VARCHAR (11),
    DT_ADMISSAO DATE,
    EXPEDIENTE VARCHAR(100),
    FUNCAO VARCHAR(50),
    CONSTRAINT PK_SERVICO PRIMARY KEY (CEP, ENDERECO, CPF),
    CONSTRAINT FK_SERVICO_FUNCIO FOREIGN KEY (CPF) REFERENCES FUNCIONARIO (CPF) ON DELETE CASCADE,
 	CONSTRAINT FK_SERVICO_CONSULTORIO FOREIGN KEY (CEP, ENDERECO) REFERENCES CONSULTORIO (CEP, ENDERECO) ON DELETE CASCADE
);

--TABELA SALA
CREATE TABLE SALA(
	CEP VARCHAR (12),
    ENDERECO VARCHAR(50),
    NUM VARCHAR(5),
    CONSTRAINT PK_SALA PRIMARY KEY (CEP, ENDERECO, NUM),
 	CONSTRAINT FK_SALA_CONSULTORIO FOREIGN KEY (CEP, ENDERECO) REFERENCES CONSULTORIO (CEP, ENDERECO) ON DELETE CASCADE
);

--TABELA CRO
CREATE TABLE CRO(
    REGISTRO VARCHAR(14) PRIMARY KEY,
    UF VARCHAR (2),
    CPF_DENTISTA VARCHAR(11) NOT NULL,
    CONSTRAINT FK_CRO_DENTISTA FOREIGN KEY (CPF_DENTISTA) REFERENCES DENTISTA (CPF) ON DELETE CASCADE
);

--TABELA CONSULTAS
CREATE TABLE CONSULTA(
    CEP VARCHAR (12),
    ENDERECO VARCHAR(50),
    NUM_SALA VARCHAR(5),
    CPF_PACIENTE VARCHAR (11),
    CPF_DENTISTA VARCHAR (11), 
    MOMENTO_CONSULTA TIMESTAMP,
    VALOR FLOAT,
    TIPO VARCHAR(30),
    CONSTRAINT PK_CONSULTA PRIMARY KEY(CEP, ENDERECO, NUM_SALA,CPF_DENTISTA,CPF_PACIENTE,MOMENTO_CONSULTA),
    CONSTRAINT FK_CONSULTA_SALA FOREIGN KEY (CEP, ENDERECO, NUM_SALA) REFERENCES SALA(CEP, ENDERECO, NUM) ON DELETE CASCADE,
    CONSTRAINT FK_CONSULTA_DENTISTA FOREIGN KEY (CPF_DENTISTA) REFERENCES DENTISTA(CPF) ON DELETE CASCADE,
    CONSTRAINT FK_CONSULTA_PACIENTE FOREIGN KEY (CPF_PACIENTE) REFERENCES PACIENTE(CPF) ON DELETE CASCADE
);

--TABELA DOCUMENTOS
CREATE TABLE DOCUMENTO (
    REGISTRO VARCHAR (14), 
    INSTANTE_EMISSAO TIMESTAMP,
    MOMENTO_CONSULTA TIMESTAMP,
    INSTRUCOES VARCHAR(256), 
    CEP VARCHAR (12) NOT NULL,
    ENDERECO VARCHAR(50) NOT NULL,
    NUM_SALA VARCHAR(5) NOT NULL,
    CPF_PACIENTE VARCHAR (11) NOT NULL,
    CPF_DENTISTA VARCHAR (11) NOT NULL, 
    CONSTRAINT FK_DOC_CONSULTA FOREIGN KEY (CEP, ENDERECO, NUM_SALA, CPF_DENTISTA, CPF_PACIENTE, MOMENTO_CONSULTA) REFERENCES CONSULTA(CEP, ENDERECO, NUM_SALA, CPF_DENTISTA, CPF_PACIENTE, MOMENTO_CONSULTA) ON DELETE CASCADE,
    CONSTRAINT FK_DOC_REGISTRO FOREIGN KEY (REGISTRO) REFERENCES CRO(REGISTRO) ON DELETE CASCADE,
    CONSTRAINT PK_DOCUMENTO PRIMARY KEY (REGISTRO, INSTANTE_EMISSAO)
);

--TABELA MEDICAMENTOS
CREATE TABLE MEDICAMENTO(
    NMR VARCHAR(13) PRIMARY KEY,
    DOSAGEM VARCHAR(50),
    TIPO VARCHAR(25),
    NOME VARCHAR(50)
);

--TABELA ATENDIMENTOS
CREATE TABLE ATENDIMENTO_DENTISTA(
    CEP VARCHAR (12),
    ENDERECO VARCHAR(50),
    CPF VARCHAR(11),
    EXPEDIENTE VARCHAR(14),
    CONSTRAINT PK_ATENDIMENTO PRIMARY KEY(CEP, ENDERECO,CPF),
    CONSTRAINT FK_ATENDE_CONSULTORIO FOREIGN KEY (CEP, ENDERECO) REFERENCES CONSULTORIO (CEP, ENDERECO) ON DELETE CASCADE
);

--TABELA DENTISTAS ACEITAM CONVÊNIOS
CREATE TABLE ACEITA_CONVENIO(
    CPF_DENTISTA VARCHAR (11),
    CNPJ VARCHAR (16),
    CONSTRAINT PK_ACEITA PRIMARY KEY(CPF_DENTISTA, CNPJ),
    CONSTRAINT FK_ACEITA_DENTISTA FOREIGN KEY (CPF_DENTISTA) REFERENCES DENTISTA(CPF) ON DELETE CASCADE,
    CONSTRAINT FK_ACEITA_CONVENIO FOREIGN KEY (CNPJ) REFERENCES CONVENIO(CNPJ) ON DELETE CASCADE
);

--TABELA DOCUMENTO PRESCREVE MEDICAMENTO
CREATE TABLE CONTROLE_PRESCRICAO(
    REGISTRO VARCHAR(14),
    INSTANTE_EMISSAO TIMESTAMP,
    REMEDIO VARCHAR(13),
    CONSTRAINT PK_PRESCRICAO PRIMARY KEY(REGISTRO, INSTANTE_EMISSAO, REMEDIO),
	CONSTRAINT FK_PRESCRICAO_DOC FOREIGN KEY (REGISTRO, INSTANTE_EMISSAO) REFERENCES DOCUMENTO(REGISTRO, INSTANTE_EMISSAO) ON DELETE CASCADE,
	CONSTRAINT FK_PRESCRICAO_MEDICAMENTO FOREIGN KEY (REMEDIO) REFERENCES MEDICAMENTO(NMR) ON DELETE CASCADE
);
